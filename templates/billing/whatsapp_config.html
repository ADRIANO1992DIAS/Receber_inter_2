{% extends "base.html" %}
{% block content %}
  <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
    <div>
      <h2 class="page-title text-2xl font-semibold">Config. WhatsApp</h2>
      <p class="page-subtitle text-sm">Evolution API e chave PIX; dados ficam criptografados no banco.</p>
    </div>
    <div class="rounded-full border border-brand-200 px-4 py-2 text-xs font-semibold uppercase tracking-[0.2em] text-brand-700">
      Criptografado
    </div>
  </div>

  <div class="rounded-3xl border border-slate-200 bg-white/80 p-5 shadow-sm">
    <p class="text-sm font-semibold text-slate-700">Substitui variaveis do .env</p>
    <p class="mt-1 text-sm text-slate-600">Preencha para migrar as chaves abaixo para o banco. Caso estejam vazias, os valores do .env aparecem como sugestao inicial.</p>
    <div class="mt-3 flex flex-wrap gap-2 text-xs font-mono text-slate-700">
      <span class="rounded-full bg-slate-100 px-3 py-1">EVOLUTION_BASE_URL</span>
      <span class="rounded-full bg-slate-100 px-3 py-1">EVOLUTION_INSTANCE_ID</span>
      <span class="rounded-full bg-slate-100 px-3 py-1">EVOLUTION_API_KEY</span>
      <span class="rounded-full bg-slate-100 px-3 py-1">WHATSAPP_PIX_KEY</span>
    </div>
  </div>

  <div class="rounded-3xl border border-slate-200 bg-white/80 p-6 shadow-sm">
    <form method="post" class="space-y-6">
      {% csrf_token %}
      {% if form.non_field_errors %}
        <div class="rounded-2xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-600">
          {% for erro in form.non_field_errors %}<p>{{ erro }}</p>{% endfor %}
        </div>
      {% endif %}

      <div class="grid gap-4 lg:grid-cols-2">
        <div class="flex flex-col gap-2">
          <label for="{{ form.evolution_base_url.id_for_label }}" class="text-sm font-semibold text-slate-700">Evolution Base URL</label>
          {{ form.evolution_base_url }}
          <p class="text-xs text-slate-500">Endpoint base da Evolution API.</p>
          {% if form.evolution_base_url.errors %}
            <div class="rounded-2xl border border-rose-200 bg-rose-50 px-4 py-2 text-xs text-rose-600">
              {% for erro in form.evolution_base_url.errors %}<p>{{ erro }}</p>{% endfor %}
            </div>
          {% endif %}
        </div>
        <div class="flex flex-col gap-2">
          <label for="{{ form.evolution_instance_id.id_for_label }}" class="text-sm font-semibold text-slate-700">Evolution Instance ID</label>
          {{ form.evolution_instance_id }}
          <p class="text-xs text-slate-500">Nome da instancia configurada na Evolution.</p>
          {% if form.evolution_instance_id.errors %}
            <div class="rounded-2xl border border-rose-200 bg-rose-50 px-4 py-2 text-xs text-rose-600">
              {% for erro in form.evolution_instance_id.errors %}<p>{{ erro }}</p>{% endfor %}
            </div>
          {% endif %}
        </div>
        <div class="flex flex-col gap-2">
          <label for="{{ form.evolution_api_key.id_for_label }}" class="text-sm font-semibold text-slate-700">Evolution API Key</label>
          {{ form.evolution_api_key }}
          <p class="text-xs text-slate-500">Chave de autenticacao; permanece escondida.</p>
          {% if form.evolution_api_key.errors %}
            <div class="rounded-2xl border border-rose-200 bg-rose-50 px-4 py-2 text-xs text-rose-600">
              {% for erro in form.evolution_api_key.errors %}<p>{{ erro }}</p>{% endfor %}
            </div>
          {% endif %}
        </div>
        <div class="flex flex-col gap-2">
          <label for="{{ form.whatsapp_pix_key.id_for_label }}" class="text-sm font-semibold text-slate-700">Chave PIX</label>
          {{ form.whatsapp_pix_key }}
          <p class="text-xs text-slate-500">Chave PIX enviada junto com a mensagem inicial.</p>
          {% if form.whatsapp_pix_key.errors %}
            <div class="rounded-2xl border border-rose-200 bg-rose-50 px-4 py-2 text-xs text-rose-600">
              {% for erro in form.whatsapp_pix_key.errors %}<p>{{ erro }}</p>{% endfor %}
            </div>
          {% endif %}
        </div>
      </div>

      <div class="flex flex-wrap justify-end gap-3">
        <a href="/dashboard/" class="inline-flex items-center justify-center rounded-full border border-slate-200 px-5 py-2 text-sm font-semibold text-slate-700 shadow-sm transition hover:border-slate-300 hover:text-slate-900">Voltar</a>
        <button type="submit" class="inline-flex items-center justify-center rounded-full bg-emerald-600 px-6 py-2 text-sm font-semibold text-white shadow-sm transition hover:brightness-110 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-400">
          Salvar configuracao
        </button>
      </div>
    </form>
  </div>
{% endblock %}
