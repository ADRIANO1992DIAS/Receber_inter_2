{% extends "base.html" %}
{% block content %}
  <div class="flex flex-col gap-6">
    <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
      <div>
        <h2 class="page-title text-2xl font-semibold">Clientes</h2>
        <p class="page-subtitle text-sm">Visualize, edite e mantenha a base de clientes sempre atualizada.</p>
      </div>
      <div class="flex flex-wrap gap-2">
        <a
          class="inline-flex items-center justify-center rounded-full border border-brand-200 px-5 py-2 text-sm font-semibold text-brand-600 transition hover:border-brand-300 hover:bg-brand-50 hover:text-brand-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500"
          href="{% url 'cliente_import' %}"
        >
          Importar planilha
        </a>
        <a
          class="inline-flex items-center justify-center rounded-full border border-slate-200 px-5 py-2 text-sm font-semibold text-slate-600 transition hover:border-brand-300 hover:text-brand-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500"
          href="{% url 'cliente_import_template' %}"
        >
          Planilha exemplo
        </a>
        <a
          class="inline-flex items-center justify-center rounded-full bg-brand-600 px-5 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-brand-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500"
          href="{% url 'cliente_create' %}"
        >
          + Novo cliente
        </a>
      </div>
    </div>

    <form method="get" class="filter-panel space-y-3 p-4 sm:p-5">
      <div class="flex items-center justify-between">
        <p class="text-sm font-semibold uppercase tracking-[0.2em] text-indigo-50">Filtro</p>
      </div>
      <div class="grid gap-4 md:grid-cols-6">
      <div class="flex flex-col gap-1 md:col-span-2">
        <label class="text-xs font-semibold uppercase tracking-wide text-slate-500" for="filtro-nome">Nome</label>
        <input
          class="w-full rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700 shadow-sm placeholder:text-slate-400 focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200"
          type="text"
          id="filtro-nome"
          name="nome"
          placeholder="Buscar por nome"
          value="{{ filtros.nome|default:'' }}"
        />
      </div>
      <div class="flex flex-col gap-1">
        <label class="text-xs font-semibold uppercase tracking-wide text-slate-500" for="filtro-dia">Dia venc.</label>
        <input
          class="w-full rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700 shadow-sm placeholder:text-slate-400 focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200"
          type="number"
          min="1"
          max="31"
          id="filtro-dia"
          name="dia_vencimento"
          placeholder="Ex.: 10"
          value="{{ filtros.dia_vencimento|default:'' }}"
        />
      </div>
      <div class="flex flex-col gap-1">
        <label class="text-xs font-semibold uppercase tracking-wide text-slate-500" for="filtro-valor-min">Valor min.</label>
        <input
          class="w-full rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700 shadow-sm placeholder:text-slate-400 focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200"
          type="text"
          id="filtro-valor-min"
          name="valor_min"
          placeholder="Ex.: 100,00"
          value="{{ filtros.valor_min|default:'' }}"
        />
      </div>
      <div class="flex flex-col gap-1">
        <label class="text-xs font-semibold uppercase tracking-wide text-slate-500" for="filtro-valor-max">Valor max.</label>
        <input
          class="w-full rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700 shadow-sm placeholder:text-slate-400 focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200"
          type="text"
          id="filtro-valor-max"
          name="valor_max"
          placeholder="Ex.: 500,00"
          value="{{ filtros.valor_max|default:'' }}"
        />
      </div>
      <div class="flex flex-col gap-1">
        <label class="text-xs font-semibold uppercase tracking-wide text-slate-500" for="filtro-status">Status</label>
        <select
          class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700 shadow-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200"
          id="filtro-status"
          name="status"
        >
          <option value="" {% if not filtros.status %}selected{% endif %}>Todos</option>
          <option value="ativos" {% if filtros.status == "ativos" %}selected{% endif %}>Apenas ativos</option>
          <option value="inativos" {% if filtros.status == "inativos" %}selected{% endif %}>Apenas inativos</option>
        </select>
      </div>
      <div class="flex items-end gap-2 md:justify-end">
        <button
          class="inline-flex items-center justify-center rounded-full bg-brand-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-brand-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500"
          type="submit"
        >
          Aplicar filtros
        </button>
        {% if filtros_ativos|default:False %}
          <a
            class="inline-flex items-center justify-center rounded-full border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-600 transition hover:border-brand-300 hover:text-brand-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500"
            href="{% url 'clientes_list' %}"
          >
            Limpar
          </a>
        {% endif %}
      </div>
      </div>
    </form>

    <div class="hidden md:block overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm">
      <table class="min-w-full divide-y divide-slate-200 text-sm">
        <thead class="bg-slate-50 text-left text-xs font-semibold uppercase tracking-wide text-slate-500">
          <tr>
            <th class="px-4 py-3">Nome</th>
            <th class="px-4 py-3">CPF/CNPJ</th>
            <th class="px-4 py-3">Status</th>
            <th class="px-4 py-3">Valor</th>
            <th class="px-4 py-3">Venc.</th>
            <th class="px-4 py-3">Telefone</th>
            <th class="px-4 py-3">Ações</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-100 text-slate-700">
          {% for c in clientes %}
            <tr class="hover:bg-slate-50">
              <td class="px-4 py-3 font-medium text-slate-900">{{ c.nome }}</td>
              <td class="px-4 py-3">{{ c.cpfCnpj }}</td>
              <td class="px-4 py-3">
                {% if c.ativo %}
                  <span class="inline-flex items-center rounded-full bg-emerald-50 px-2.5 py-0.5 text-xs font-semibold text-emerald-700">
                    Ativo
                  </span>
                {% else %}
                  <span class="inline-flex items-center rounded-full bg-rose-50 px-2.5 py-0.5 text-xs font-semibold text-rose-700">
                    Inativo
                  </span>
                {% endif %}
              </td>
              <td class="px-4 py-3 font-semibold text-slate-900">R$ {{ c.valorNominal }}</td>
              <td class="px-4 py-3">{{ c.dataVencimento }}</td>
              <td class="px-4 py-3">
                <span class="inline-flex items-center gap-1 whitespace-nowrap">
                  {% if c.ddd %}
                    <span>{{ c.ddd }}</span>
                  {% endif %}
                  <span>{{ c.telefone|default:'-' }}</span>
                </span>
              </td>
              <td class="px-4 py-3">
                <div class="flex flex-wrap gap-2">
                  <a
                    class="inline-flex items-center justify-center rounded-full border border-slate-200 px-3 py-1 text-xs font-semibold text-slate-600 transition hover:border-brand-300 hover:text-brand-700"
                    href="{% url 'cliente_update' c.id %}"
                  >
                    Editar
                  </a>
                  <a
                    class="inline-flex items-center justify-center rounded-full border border-rose-200 px-3 py-1 text-xs font-semibold text-rose-600 transition hover:border-rose-300 hover:bg-rose-50"
                    href="{% url 'cliente_delete' c.id %}"
                  >
                    Excluir
                  </a>
                </div>
              </td>
            </tr>
          {% empty %}
            <tr>
              <td class="px-4 py-6 text-center text-sm text-slate-500" colspan="7">
                Nenhum cliente cadastrado.
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="space-y-4 md:hidden">
      {% for c in clientes %}
        <article class="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
          <header class="flex flex-col gap-1">
            <span class="text-sm font-semibold uppercase tracking-wide text-brand-600">Cliente</span>
            <h3 class="text-lg font-semibold text-slate-900">{{ c.nome }}</h3>
            <p class="text-sm text-slate-500">{{ c.cpfCnpj }}</p>
          </header>
          <div class="mt-2">
            {% if c.ativo %}
              <span class="inline-flex items-center rounded-full bg-emerald-50 px-3 py-0.5 text-xs font-semibold uppercase tracking-wide text-emerald-700">
                Ativo
              </span>
            {% else %}
              <span class="inline-flex items-center rounded-full bg-rose-50 px-3 py-0.5 text-xs font-semibold uppercase tracking-wide text-rose-700">
                Inativo
              </span>
            {% endif %}
          </div>
          <dl class="mt-4 grid grid-cols-1 gap-3 text-sm text-slate-600">
            <div>
              <dt class="font-semibold text-slate-500">Valor</dt>
              <dd class="text-slate-900 font-medium">R$ {{ c.valorNominal }}</dd>
            </div>
            <div>
              <dt class="font-semibold text-slate-500">Vencimento</dt>
              <dd>{{ c.dataVencimento }}</dd>
            </div>
            <div>
              <dt class="font-semibold text-slate-500">Telefone</dt>
              <dd>
                <span class="inline-flex items-center gap-1 whitespace-nowrap">
                  {% if c.ddd %}
                    <span>{{ c.ddd }}</span>
                  {% endif %}
                  <span>{{ c.telefone|default:"-" }}</span>
                </span>
              </dd>
            </div>
          </dl>
          <footer class="mt-4 flex flex-wrap gap-2">
            <a
              class="inline-flex items-center justify-center rounded-full border border-slate-200 px-3 py-1 text-xs font-semibold text-slate-600 transition hover:border-brand-300 hover:text-brand-700"
              href="{% url 'cliente_update' c.id %}"
            >
              Editar
            </a>
            <a
              class="inline-flex items-center justify-center rounded-full border border-rose-200 px-3 py-1 text-xs font-semibold text-rose-600 transition hover:border-rose-300 hover:bg-rose-50"
              href="{% url 'cliente_delete' c.id %}"
            >
              Excluir
            </a>
          </footer>
        </article>
      {% empty %}
        <p class="rounded-2xl border border-dashed border-slate-200 bg-white p-4 text-center text-sm text-slate-500">
          Nenhum cliente cadastrado.
        </p>
      {% endfor %}
    </div>
  </div>
{% endblock %}
